---
layout: post
title: Memory Corruption & Control Flow Hijacking
subtitle: 
cover-img: /assets/img/path.jp
thumbnail-img: /assets/img/thumb.pn
share-img: /assets/img/path.jp
tags: [Binary-Exploit]
author: BitInfiltrator
---

First of all, we need to create a file, and i call it `program.c` and open this up, we write our little `int main`, we've got memory corruption what does that mean? well it means we got memory first and foremost before we can have memory corruption. How do we get some memory in C? lets create just a little buffer and we'll say this buffer can hold 100 bytes:
```
# program.c
int main()
{
    char buffer[100];
}
```
now let's read into the buffer, if you were a normal person you would probably write this as like let's read from zero for standard in, read into the buffer, and maybe you want to be like real explicit and say `&buffer` but `buffer` is the same thing in this case and you might say `sizeof(buffer)`, because the sizeof this buffer is 100 and we use sizeof to just not even mess around, we know what is gonna happen, if i compile the following code:
```
# program.c
#include <unistd.h>

int main()
{
    char buffer[100];
    read(0,buffer, sizeof(buffer));
}
```
using gcc compiler, i say `gcc program.c -o program` and then we all know what's gonna happen i run the program, i type test and it stops blocking ![Image](/assets/img/RunningTheProgram.png) if i run `strace` what is happening there:
```
# strace ./program

execve("./program", ["./program"], 0x7ffd58beb600 /* 54 vars */) = 0
brk(NULL)                               = 0x5648f5c18000
mmap(NULL, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f8203e05000
access("/etc/ld.so.preload", R_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/etc/ld.so.cache", O_RDONLY|O_CLOEXEC) = 3
newfstatat(3, "", {st_mode=S_IFREG|0644, st_size=88751, ...}, AT_EMPTY_PATH) = 0
mmap(NULL, 88751, PROT_READ, MAP_PRIVATE, 3, 0) = 0x7f8203def000
close(3)                                = 0
openat(AT_FDCWD, "/lib/x86_64-linux-gnu/libc.so.6", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\3\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0P~\2\0\0\0\0\0"..., 832) = 832
pread64(3, "\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0"..., 784, 64) = 784
newfstatat(3, "", {st_mode=S_IFREG|0755, st_size=1933688, ...}, AT_EMPTY_PATH) = 0
pread64(3, "\6\0\0\0\4\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0@\0\0\0\0\0\0\0"..., 784, 64) = 784
mmap(NULL, 1985936, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7f8203c0a000
mmap(0x7f8203c30000, 1404928, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x26000) = 0x7f8203c30000
mmap(0x7f8203d87000, 348160, PROT_READ, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x17d000) = 0x7f8203d87000
mmap(0x7f8203ddc000, 24576, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x1d1000) = 0x7f8203ddc000
mmap(0x7f8203de2000, 52624, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_ANONYMOUS, -1, 0) = 0x7f8203de2000
close(3)                                = 0
mmap(NULL, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0) = 0x7f8203c07000
arch_prctl(ARCH_SET_FS, 0x7f8203c07740) = 0
set_tid_address(0x7f8203c07a10)         = 2034
set_robust_list(0x7f8203c07a20, 24)     = 0
rseq(0x7f8203c08060, 0x20, 0, 0x53053053) = 0
mprotect(0x7f8203ddc000, 16384, PROT_READ) = 0
mprotect(0x5648f4a96000, 4096, PROT_READ) = 0
mprotect(0x7f8203e37000, 8192, PROT_READ) = 0
prlimit64(0, RLIMIT_STACK, NULL, {rlim_cur=8192*1024, rlim_max=RLIM64_INFINITY}) = 0
munmap(0x7f8203def000, 88751)           = 0
read(0, ABCDEF
"ABCDEF\n", 100)                = 7
exit_group(0)                           = ?
+++ exited with 0 +++
```
All of this initialization syscall stuff being done under the hood by the C runtime standard library, the thing that ultimately calls main(), as you might know the main is not the first instruction to run there's stuff before it and that stuff is part of the runtime and ultimately we do a read syscall and if i say `ABCDEF` we'll see that it read from zero and it has some address and strace is showing the contents of that address rather than showing address.